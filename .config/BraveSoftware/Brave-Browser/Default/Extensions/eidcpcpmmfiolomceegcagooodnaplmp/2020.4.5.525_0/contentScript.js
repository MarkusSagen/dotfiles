window.isEventListenerAdded||(window.isEventListenerAdded=!1),args.tabId&&function(){const e=document.createElement("random-element-name-against-collision-with-css-of-page");e.id="progress--this-is-some-random-id-name-that-do-not-collide-with-existing-id-in-dom";const t=document.createElement("random-element-name-against-collision-with-css-of-page");t.classList.add("intelligentspeaker--indeterminate--please-do-not-collide"),e.appendChild(t),document.body.insertBefore(e,null),setTimeout(t=>e.classList.add("intelligentspeaker--active--please-do-not-collide"),100),!window.isEventListenerAdded&&chrome.runtime.onMessage.addListener(e=>{window.isEventListenerAdded=!0;const t=document.getElementsByTagName("random-element-name-against-collision-with-css-of-page")[0];t.classList.remove("intelligentspeaker--active--please-do-not-collide"),setTimeout(e=>t.remove(),500),function(e){if(!e)return;const t=document.createElement("intelligentspeaker--snackbar");t.innerText=e,document.body.insertBefore(t,null),setTimeout(e=>t.classList.add("intelligentspeaker--snackbar--class_active"),9),setTimeout(e=>{t.classList.remove("intelligentspeaker--snackbar--class_active"),setTimeout(e=>t.remove(),500)},3e3)}(e["snackbar--text"])})}();var e=window.getSelection().toString();if(!e)for(let n of document.getElementsByTagName("iframe")){try{var t=n.contentDocument.getSelection().toString()}catch(e){continue}if(t){e=t;break}}if(e.trim())n(e.trim());else if(window.location.href.match(/.+\.[m.]?wikipedia.org\/.+/)){const e=window.location.host.split(".")[0],t=document.documentElement.outerHTML.match(/"wgArticleId":\d+/)[0].split(":")[1];fetch("https://"+e+".wikipedia.org/w/api.php?action=query&prop=extracts&explaintext&format=json&origin=*&pageids="+t).then(e=>e.json()).then(e=>{n(e.query.pages[t].extract.replace(/=/g,""))})}else if(window.location.href.startsWith("https://docs.google.com/document/d")){const e=new class{constructor(){this.textInDOM="",this.selectedText="";for(const e of document.getElementsByClassName("kix-paragraphrenderer")){this.textInDOM+=e.innerText.replace(/\n/g,"")+"\n";for(const t of e.getElementsByClassName("kix-lineview"))for(const e of t.getElementsByClassName("kix-selection-overlay")){const n=e.getBoundingClientRect();for(const e of document.getElementsByClassName("kix-wordhtmlgenerator-word-node")){const o=this.cleanDocumentText(e.innerText),s=e.getBoundingClientRect();if(this.doesRectsOverlap(s,n)){const i=this.getLocalCaretIndex(n.left-s.left,e,t),a=this.getLocalCaretIndex(n.left+n.width-s.left,e,t);this.selectedText+=o.substring(i,a)}}}}}doesRectsOverlap(e,t){return e.left<=t.right&&e.right>=t.left&&e.top<=t.bottom&&e.bottom>=t.top}getLocalCaretIndex(e,t,n){const o=this.cleanDocumentText(t.innerText),s=document.createElement("div"),i=[];for(const e of o){const n=document.createElement("span");n.innerText=e,n.style.cssText=t.style.cssText,n.style.whiteSpace="pre",i.push(n),s.appendChild(n)}n.appendChild(s);let a=0,r=-1;const c=s.getBoundingClientRect();for(let t=0;t<i.length;t++){const n=i[t].getBoundingClientRect(),o=n.left-c.left,s=o+n.width;-1==r&&(r=Math.abs(e-o));const l=Math.abs(e-o),d=Math.abs(e-s);l<=r&&(a=t,r=l),d<=r&&(a=t+1,r=d)}return s.remove(),a}cleanDocumentText(e){let t=e.replace(/\u200B/g,"");const n=String.fromCharCode(160),o=new RegExp(n,"g");return t=t.replace(o," "),t}getFullText(){const e=document.body.innerHTML.match(/DOCS_modelChunk = \[{.+"s":"(.+?)[^\\]"},{/)[1];return e.length<this.textInDOM.length?this.textInDOM:e}};n(e.selectedText||e.getFullText())}else n(document.documentElement.outerHTML);function n(e){args.stringForVoicing=e,args.lang?chrome.runtime.sendMessage(args):chrome.i18n.detectLanguage(args.stringForVoicing||document.body.innerText,e=>{const t=e.languages[0].language;t?(args.lang=t,chrome.runtime.sendMessage(args)):alert("Cannot detect language :(")})}